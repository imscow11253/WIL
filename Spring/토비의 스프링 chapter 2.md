
145p ~ 207p


í† ë¹„ëŠ” ìŠ¤í”„ë§ì´ ê°œë°œìì—ê²Œ ì œê³µí•˜ëŠ” ê°€ì¥ ì¤‘ìš”í•œ ê°€ì¹˜ëŠ” ==ê°ì²´ì§€í–¥==ê³¼ ==í…ŒìŠ¤íŠ¸== ë¼ê³  í•œë‹¤. 
1ì¥ì—ì„œ ê°ì²´ì§€í–¥ ì¢€ ë°°ì› ìœ¼ë‹ˆê¹Œ 2ì¥ì—ì„  í…ŒìŠ¤íŠ¸ì— ëŒ€í•´ì„œ ì‚´í´ë³¸ë‹¤.

ìŠ¤í”„ë§ìœ¼ë¡œ ê°œë°œí•˜ë©´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ì§€ ì•ŠëŠ” ê²ƒì€ ìŠ¤í”„ë§ì˜ ê°€ì¹˜ë¥¼ ì ˆë°˜ í¬ê¸°í•˜ëŠ” ê²ƒì´ë¼ê³  í•œë‹¤.ğŸ˜±

ìŠ¤í”„ë§ì—ì„œì˜ í…ŒìŠ¤íŠ¸ëŠ” ì‘ì€ ë‹¨ìœ„ì˜ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë„ë¡ í•´ì¤€ë‹¤. --> ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

ì´ˆê¸°ì—ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì˜ ì¥ì ì— ëŒ€í•´ì„œ ì¤„ì¤„ ì„¤ëª…í•œë‹¤. 

## UserDaoTest ì½”ë“œ ê°œì„ 

ì—¬ê¸°ì„œë„ 1ì¥ì—ì„œì²˜ëŸ¼ ì½”ë“œë¥¼ ê°œì„ í•´ë‚˜ê°€ë©° í…ŒìŠ¤íŠ¸ì˜ ê°œë…ì„ ì„¤ëª…í•œë‹¤. 
1ì¥ì—ì„œ UserDao í´ë˜ìŠ¤ì˜ ë™ì‘ì„ ê²€ì¦í•˜ê¸° ìœ„í•´ ë§Œë“¤ì—ˆë˜ UserDaoTest ë¼ëŠ” ì½”ë“œë¥¼ ê°œì„ í•œë‹¤. 

UserDaoTestëŠ” main í•¨ìˆ˜ì—ì„œ í˜¸ì¶œë˜ëŠ” í˜•íƒœì´ê³ , ë¬¸ì œì ì´ 2ê°€ì§€ ì¡´ì¬í•œë‹¤.

1. ìˆ˜ë™ í™•ì¸ ì‘ì—… 
   ê°œë°œìê°€ ì§ì ‘ DB ë³€ê²½ ì—¬ë¶€ë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤.
2. ì‹¤í–‰ ì‘ì—…ì˜ ë²ˆê±°ë¡œì›€
   êµ‰ì¥íˆ ë§ì€ Daoê°€ ë§Œë“¤ì–´ì ¸ì„œ DaoTestë„ ë§ì´ ë§Œë“¤ì–´ì§€ë©´ main ë©”ì†Œë“œê°€ ë¬´ê±°ì›Œì§„ë‹¤.

1ë²ˆ ë¬¸ì œë¥¼ ìš°ì„  í•´ê²°í•´ë³´ë©´, DBì— ì €ì¥ í›„ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ì„œ ì €ì¥í•˜ë ¤ê³  í–ˆë˜ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ì•ˆí•˜ëŠ”ì§€ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¦¬íŒ©í† ë§í•  ìˆ˜ ìˆë‹¤. 

```java
if(!user.getName().equals(user2.getName())){
	System.out.println("í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (name)");
}
else if(!user.getPassword().equals(user2.getPassword())){
	System.out.println("í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (password)");
}
else{
	System.out.println("ì¡°íšŒ í…ŒìŠ¤íŠ¸ ì„±ê³µ");
}
```

2ë²ˆ ë¬¸ì œëŠ” JUnitì´ë¼ëŠ” í…ŒìŠ¤íŒ… í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•´ì„œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

```java
public class UserDaoTest{
	@Test
	public void addAndGet() throws SQLException{
		ApplicationContext context = new 
			ClassPathXmlApplicationContext("applicationContext.xml");
		
		UserDao dao = context.getBean("UserDao", UserDao.class);
		...
	}
}
```

ì´ëŸ° ì‹ìœ¼ë¡œ public ì„ ì–¸í•˜ê³  @Test ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ê³ , íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©°, return ê°’ì´ voidë¡œ ë©”ì†Œë“œë¥¼ ì„ ì–¸í•˜ë©´ JUnit í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 

ê·¸ë¦¬ê³  ìœ„ì—ì„œ if-else ë¬¸ìœ¼ë¡œ ê°’ì„ ë¹„êµ ê²€ì¦í–ˆë˜ ê²ƒì„ assertThatì´ë¼ëŠ” static methodë¥¼ ì‚¬ìš©í•´ë³´ì.

```java
assertThat(user2.getName(), is(user.getName()));
```

assertThat ë©”ì†Œë“œëŠ” 
ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì˜ ê°’ì„ ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì¸ Matcherì™€ ë¹„êµí•´ì„œ ì¼ì¹˜í•˜ë©´ ë„˜ì–´ê°€ê³ , ì•„ë‹ˆë©´ ì‹¤íŒ¨í•œë‹¤. 

is()ëŠ” ë§¤ì²˜ì˜ ì¼ì¢…ìœ¼ë¡œ equalsì™€ ê°™ë‹¤.

==JUnit í”„ë ˆì„ì›Œí¬ë¥¼ ì‹¤í–‰==í•˜ê¸° ìœ„í•´ì„œëŠ” ì–´ë””ì—ëŠ” main ë©”ì†Œë“œë¥¼ í•˜ë‚˜ ì¶”ê°€í•˜ê³ , ê·¸ ì•ˆì— JUnitCore í´ë˜ìŠ¤ì˜ main ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ì½”ë“œë¥¼ ë„£ì–´ì£¼ë©´ ëœë‹¤.
ê·¸ë¦¬ê³  ì¸ìê°’ìœ¼ë¡œ ì‹¤í–‰í•  í´ë˜ìŠ¤ pathë¥¼ ì§€ì •í•´ì£¼ë©´ ëœë‹¤.

```java
public static void main(String[] args){
	JUnitCore.main("springbook.user.dao.UserDaoTest");
}
```


ë‹¤ë§Œ ë¬¸ì œê°€ í•˜ë‚˜ ë” ìˆë‹¤. testë¥¼ í•œ ë²ˆ ì‹¤í–‰í•˜ê³  ë‚˜ë©´ DBì— user ê°€ ìƒì„±ë˜ì–´ì„œ ë‹¤ìŒë²ˆ testë¥¼ ëŒë¦´ ë•Œì—” ì‹¤íŒ¨í•  ê²ƒì´ë‹¤. 

ê·¸ë˜ì„œ UserDaoì— deleteAll() ê³¼ getCount() ë©”ì„œë“œë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ ì´ë¥¼ í™œìš©í•˜ë©´ ëœë‹¤.

```java
@Test
public void addAndGet() throws SQLException{
	...
	dao.deleteAll();
	assertThat(dao.getCount(), is(0));

	User user = new User();
	user.setId("gyumee");
	user.setName("ë°•ì„±ì² ");
	user.setPassword("springno1");

	dao.add(user);
	assertThat(dao.getCount(), is(1));

	User user2 = dao.get(user.getId());

	assertThat(user2.getName(), is(user.getName()));
	assertThat(user2.getPassword(), is(user.getPassword()));
}
```

ê·¸ë¦¬ê³  ì±…ì—ì„œëŠ” getCount() ë©”ì†Œë“œì— ëŒ€í•´ì„œ ì¶”ê°€ì ì¸ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•œë‹¤.

>[!tip] JUnitì€ ì—¬ëŸ¬ê°œì˜ test ë©”ì†Œë“œë“¤ì´ ì¡´ì¬í•  ë•Œ ì‹¤í–‰ ìˆœì„œë¥¼ ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤.
>ë§Œì•½ ìˆœì„œì— ì˜í–¥ì„ ë°›ë„ë¡ test codeë¥¼ ì§°ìœ¼ë©´ ì˜ëª» ì§ ê±°ë‹¤.

ê·¸ ì™¸ì—ë„ get() ë©”ì†Œë“œ, add() ë©”ì†Œë“œì— ëŒ€í•´ì„œ ì˜ˆì™¸ ìƒí™© ë“±ì˜ ì¶”ê°€ì ì¸ í…ŒìŠ¤íŠ¸ ì½”ë“œë“¤ì„ ì‘ì„±í•œë‹¤. 
ì˜ˆì™¸ê°€ ë˜ì ¸ì§€ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒìœ¼ë¡œ í™•ì¸í•˜ëŠ”ë°,
ì˜ˆì™¸ê°€ ë˜ì ¸ì§€ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì€ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```java
@Test(expected = EmptyResultDataAccessException.class)
```

## TDD  í…ŒìŠ¤íŠ¸ ì£¼ë„ ê°œë°œ

í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ì˜ ì‘ì„±ëœ ê¸°ëŠ¥ëª…ì„¸ì„œë¡œ ì“°ì¼ ìˆ˜ ìˆë‹¤. 

ì¥ì 
- ê¼¼ê¼¼í•œ ê¸°ëŠ¥ ëª…ì„¸
- ê°œë°œ ì½”ë“œì— ëŒ€í•œ ì¦‰ê°ì ì¸ í”¼ë“œë°±

>[!warning] ì˜¤íˆë ¤ ê°œë°œ ì†ë„ê°€ ì˜¤ë˜ ê±¸ë¦¬ì§€ ì•Šì„ê¹Œ?
>í…ŒìŠ¤íŠ¸ëŠ” ì‘ì„±í•˜ê¸° ì‰¬ìš°ë©°, ê° í…ŒìŠ¤íŠ¸ê°€ ë…ë¦½ì ì´ë‹¤. í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ëŠ”ë° ë§ì€ ì‹œê°„ì´ ë“¤ì§€ ì•Šìœ¼ë©°, í•œ ë²ˆ ì‘ì„±í•´ë†“ìœ¼ë©´ ê³„ì† ì“¸ ìˆ˜ ìˆìœ¼ë‹ˆ ì˜¤íˆë ¤ ì¢‹ë‹¤.


## JUnit ì˜ ë¶€ê°€ì ì¸ ê¸°ëŠ¥ë“¤

JUnitì´ í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. 
1. í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì—ì„œ @Testê°€ ë¶™ì€ public ì´ê³ , void í˜•ì´ë©°, íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” ë©”ì†Œë“œë¥¼ ì°¾ëŠ”ë‹¤.
2. í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ í•˜ë‚˜ ë§Œë“ ë‹¤.
3. @Beforeê°€ ë¶™ì€ ë©”ì†Œë“œê°€ ìˆìœ¼ë©´ ë¨¼ì € ì‹¤í–‰í•œë‹¤.
4. @Testê°€ ë¶™ì€ ë©”ì†Œë“œë¥¼ í•˜ë‚˜ í˜¸ì¶œí•˜ê³  ê²°ê³¼ë¥¼ ì €ì¥í•´ì¤€ë‹¤. 
5. @Afterê°€ ë¶™ì€ ë©”ì†Œë“œê°€ ìˆìœ¼ë©´ ì‹¤í–‰í•œë‹¤.
6. ë‚˜ë¨¸ì§€ì— ëŒ€í•´ì„œë„ 3~5 ë²ˆì„ ë°˜ë³µí•œë‹¤. 
7. ëª¨ë“  í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ì¢…í•©í•´ì„œ ëŒë ¤ì¤€ë‹¤.

ì‹¤ì œë¡œëŠ” ë” ë³µì¡í•˜ë‹¤.
ì¦‰, ê° testë¥¼ ì‹¤í–‰í•˜ê¸° ì „ê³¼ í›„ì— before, after ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•œë‹¤ëŠ” ê²ƒì´ë‹¤. 

>[!warning] Before, After ë©”ì†Œë“œë¥¼ test ë©”ì†Œë“œì—ì„œ ì§ì ‘ í˜¸ì¶œí•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ì„œ ì„œë¡œ ì£¼ê³  ë°›ì„ ì •ë³´ë‚˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ìˆìœ¼ë©´ test classì˜ í•„ë“œ ê°’ì„ ì´ìš©í•´ì•¼ í•œë‹¤.

>[!info] ê° í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒˆë¡œ ë§Œë“ ë‹¤. ì´ì „ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì˜¤ë¸Œì íŠ¸ëŠ” ë²„ë ¤ì§„ë‹¤.
>Why?
>ê° í…ŒìŠ¤íŠ¸ê°€ ì„œë¡œ ì˜í–¥ì„ ì£¼ì§€ ì•Šê³  ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ë¨ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ì„œ JUnit ê°œë°œìê°€ ê·¸ë ‡ê²Œ ì§°ë‹¤. 
>ê·¸ë˜ì„œ ë§Œì•½ ê³µìœ í•´ì•¼ í•˜ëŠ” ìì›ì´ ìˆë‹¤ë©´ ë³„ë„ì˜ í´ë˜ìŠ¤ì˜ ë©”ì†Œë“œë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

### í”½ìŠ¤ì²˜ Fixture

í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ëŠ”ë° í•„ìš”í•œ ì •ë³´ë‚˜ ì˜¤ë¸Œì íŠ¸ë“¤ì„ ì˜ë¯¸í•œë‹¤.



## SpringTest

ê¸°ì¡´ Before ì½”ë“œëŠ” ë¬¸ì œê°€ ìˆë‹¤. 

```java
@Before 
public void setUp(){
	ApplicationContext context = new GenericXmlApplicationContext("application.xml");
	this.dao = context.getBean("userDao", UserDao.class);
}
```

â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸
ì´ëŸ¬ë©´ Test ë©”ì†Œë“œê°€ ì‹¤í–‰ë  ë•Œë§ˆë‹¤ Before ë©”ì†Œë“œê°€ ì‹¤í–‰ë˜ë¯€ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ê°€ test ë©”ì†Œë“œ ê°œìˆ˜ë§Œí¼ ìƒì„±ëœë‹¤. 

í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ê° testê°€ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê²ƒì´ ì›ì¹™ì´ì§€ë§Œ
ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ì²˜ëŸ¼ ë¬´ê±°ìš´ ê²ƒì€ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì „ì²´ê°€ ê³µìœ í•˜ë„ë¡ ë§Œë“¤ê¸°ë„ í•œë‹¤. 

ê³µìœ í•˜ë„ë¡ ë§Œë“¤ê³  ì‹¶ì€ë° JUnitì´ í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒˆë¡œ ìƒì„±í•œë‹¤ëŠ” ì ì´ë‹¤. 
ì¦‰, ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì˜¤ë¸Œì íŠ¸ ë ˆë²¨ì— ì €ì¥í•´ë‘ë©´ ê³µìœ í•  ìˆ˜ ì—†ë‹¤ëŠ” ëœ»ì´ë‹¤. 

staticì— ì €ì¥í•´ë‘ë©´?
@BeforeClass ë¼ëŠ” ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ ë©”ì†Œë“œëŠ” í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì— ê±¸ì³ì„œ í•œ ë²ˆë§Œ ì‹¤í–‰ëœë‹¤. 
ì´ê±¸ë¡œ static ë³€ìˆ˜ì— ì €ì¥í•´ë‘˜ ìˆ˜ ìˆê² ì§€ë§Œ

==ìŠ¤í”„ë§ì€ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸ì—ì„œ ì“¸ ìˆ˜ ìˆë„ë¡ ì§€ì›==í•œë‹¤. 
ì •í™•íˆ ë§í•˜ë©´, ìŠ¤í”„ë§ì€ JUnitì„ ì´ìš©í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì´ë‹¤.
ì–´ë…¸í…Œì´ì…˜ë§Œìœ¼ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ê³µìœ í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆë‹¤. 

```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations="/applicationContext.xml")
public class UserDaoTest{
	@Autowired
	private ApplicationContext context;
	//ì´ë ‡ê²Œ ë§ê³  UserDaoë¥¼ ë°”ë¡œ Autowiredë¡œ DI ë°›ì•„ë„ ëœë‹¤.
	...

	@Before 
	public void setUp(){
		this.dao = this.context.getBean("userDao", UserDao.class);
	}
}
```

ì´ë ‡ê²Œ @RunWith ì™€ @ContextConfiguration ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ 
@Autowiredë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì£¼ì… ë°›ì„ ìˆ˜ ìˆë‹¤. 

==@RunWith==
JUnit í”„ë ˆì„ì›Œí¬ì˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²•ì„ í™•ì¥í•  ë•Œ ì‚¬ìš©í•œë‹¤.
ì—¬ê¸°ì„œëŠ” SpringJUnit4ClassRunner ë¼ëŠ” JUnit ìš© í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ í™•ì¥ í´ë˜ìŠ¤ë¥¼ ê°™ì´ ì‚¬ìš©í–ˆë‹¤. 

==@ContextConfiguration==
ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ì˜ xml íŒŒì¼ì„ ì§€ì •í•˜ëŠ” ê²ƒì´ë‹¤. 

>[!note]  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•´ì¤˜ì•¼ í•œë‹¤.
>org.springframework.test-3.0.7.RELEASE.jar


## í…ŒìŠ¤íŠ¸ì—ì„œ DI

ì´ëŸ° ì˜ë¬¸ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤. DB Connection ì •ë³´ëŠ” ë³€ê²½í•˜ì§€ ì•Šì„ ê±´ë° êµ³ì´ DI í•´ì•¼í•´?
ê·¸ëƒ¥ ê°ì²´ ìƒì„±í•´ì„œ ì“°ë©´ ë˜ì–ì•„?

1. ë³€ê²½ë˜ì§€ ì•Šìœ¼ë¦¬ë€ ë³´ì¥ì´ ì—†ë‹¤.
2. ë‹¤ë¥¸ ì°¨ì›ì˜ ì„œë¹„ìŠ¤ë¥¼ ì¶”ê°€í•˜ê¸°ê°€ ì¢‹ë‹¤.
3. ì‘ì€ ë‹¨ìœ„ì˜ í…ŒìŠ¤íŠ¸ê°€ ì‰½ë‹¤.

ë§Œì•½ ë°°í¬ìš© DBì—ë‹¤ê°€ testë¥¼ ëŒë¦¬ê²Œ ë˜ë©´ ë°°í¬ DBê°€ ì†ìƒë  ìš°ë ¤ê°€ ìˆë‹¤.
ê·¸ë˜ì„œ Before ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ DI ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

```java
@DirtiesContext
public class UserDaoTest{
	@Autowired
	UserDao dao;

	@Before 
	public void setUp(){
		DataSource dataSource = new SingleConnectionDataSource(
			"jdbc:mysql://localhost/testdb", "spring", "book", true
		);
		dao.setDataSource(dataSource);
	}
}
```

ì—¬ê¸°ì„œ UserDaoTest í´ë˜ìŠ¤ì— ë¶™ëŠ” @DirtiesContextëŠ” 
í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œì—ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ì˜ êµ¬ì„±ì´ë‚˜ ìƒíƒœë¥¼ ë³€ê²½í•œë‹¤ëŠ” ê²ƒì„ í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ì—ê²Œ ì•Œë ¤ì£¼ëŠ” ê²ƒì´ë‹¤. ê·¸ë¦¬ê³  ì´ ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ í´ë˜ìŠ¤ì—ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ ê³µìœ ë¥¼ í—ˆìš©í•˜ì§€ ì•Šê²Œ í•´ì„œ ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì— ì˜í–¥ì´ ê°€ì§€ ì•Šë„ë¡ í•œë‹¤.

ì´ëŸ¬ë©´ xml ì„ ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ì˜¤ë¸Œì íŠ¸ ê´€ê³„ë¥¼ ì¬êµ¬ì„±í•  ìˆ˜ ìˆë‹¤. 

ê·¸ëŸ¬ì§€ ë§ê³  testìš© DataSource ë¹ˆì„ í•˜ë‚˜ ìƒˆë¡œ ë§Œë“œëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.
í˜¹ì€ testìš© xml íŒŒì¼ì„ ë§Œë“¤ì.

## ê·¸ë˜ì„œ ì–´ë–¤ê±°?

DIë¥¼ ì´ìš©í•œ test ë°©ë²•ì—ëŠ” ì—¬ëŸ¬ ê°€ì§€ê°€ ì¡´ì¬í•œë‹¤. 
1. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì´ìš© && DirtiesContext
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì´ìš© && test ìš© bean 
3. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì•ˆì“°ê³  ì§ì ‘ ë¹ˆ ìƒì„±

>[!summary] ê·¸ë˜ì„œ ë­ì¨ì•¼ í•˜ëŠ”ë°?
ì €ìëŠ” ==í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì•ˆì“°ëŠ” ê²ƒì„ ì¶”ì²œ==í•œë‹¤. 
ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ë„ìš°ëŠ”ë° ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ê¸° ë–„ë¬¸ì´ë‹¤. 
>
ê·¼ë° ì˜¤ë¸Œì íŠ¸ê°€ ë³µì¡í•œ ì˜ì¡´ê´€ê³„ë¥¼ ë§ºê³  ìˆë‹¤ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì¨ì„œ xml ì„¤ì •ì„ ì´ìš©í•œ DIë¥¼ ì¶”ì²œí•œë‹¤.
ì´ ê²½ìš° testìš© xmlì„ ë”°ë¡œ ë§Œë“¤ë¼ê³  í•œë‹¤.
>
>í…ŒìŠ¤íŠ¸ìš© xmlì„ ë§Œë“¤ì—ˆë‹¤ê³  í•´ë„ ì˜ˆì™¸ì ì¸ ì˜ì¡´ê´€ê³„ê°€ í•„ìš”í•  ê²½ìš°, ìˆ˜ë™ DIí•˜ê³  ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ì— ì˜í–¥ì´ ì•ˆê°€ë„ë¡ @DirtiesContextë¥¼ ë¶™ì´ë¼ê³  í•œë‹¤.


## í•™ìŠµ í…ŒìŠ¤íŠ¸ ì‘ì„±ìœ¼ë¡œ ìŠ¤í”„ë§ì„ ë°°ì›Œë³´ì?

ë‚´ê°€ ì‘ì„±í•œ ì½”ë“œê°€ ì•„ë‹Œ ë‚¨ì´ ì“´ ì½”ë“œì— í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²½ìš°ê°€ ìˆì„ê¹Œ?

í•™ìŠµí…ŒìŠ¤íŠ¸ê°€ ê·¸ëŸ° ê²½ìš°ë‹¤. 
í•™ìŠµí…ŒìŠ¤íŠ¸ë€ ìì‹ ì´ ì‚¬ìš©í•  APIë‚˜ í”„ë ˆì„ì›Œí¬ì˜ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ì„œ ì‚¬ìš© ë°©ë²•ì„ ìµíˆëŠ” ê²ƒì´ë‹¤. 
ìì‹ ì´ í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ë ¤ê³  í•˜ëŠ” ê¸°ìˆ ì´ë‚˜ ê¸°ëŠ¥ì— ëŒ€í•´ ì–¼ë§ˆë‚˜ ì´í•´í•˜ê³  ìˆëŠ”ì§€, ì‚¬ìš©ë°©ë²•ì€ ì˜ ì•„ëŠ”ì§€ë¥¼ ê²€ì¦í•˜ëŠ” ê²ƒì´ ëª©ì ì´ë‹¤. 

ì§ì ‘ ê°„ë‹¨í•œ ì˜ˆì œë¥¼ ë§Œë“¤ë©´ì„œ ë°°ì›Œë„ ë˜ëŠ”ë° ì™œ êµ³ì´ í…ŒìŠ¤íŠ¸ë¥¼ ì“°ë‚˜?

1. ë‹¤ì–‘í•œ ì¡°ê±´ì— ë”°ë¥¸ ê¸°ëŠ¥ì„ í™•ì¸ ê°€ëŠ¥
2. ê°œë°œ ì¤‘ì— í•™ìŠµ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì°¸ê³  ê°€ëŠ¥
3. í”„ë ˆì„ì›Œí¬, ì œí’ˆì„ ì—…ê·¸ë ˆì´ë“œ í•  ë•Œ í˜¸í™˜ì„± ê²€ì¦
4. í…ŒìŠ¤íŠ¸ ì‘ì„±ì— ì¢‹ì€ í›ˆë ¨
5. ìƒˆë¡œìš´ ê¸°ìˆ  ê³µë¶€ê°€ ì¦ê±°ì›Œì§(?)

ìŠ¤í”„ë§ì„ ê³µë¶€í•  ë•Œë„ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì§ì ‘ ë§Œë“¤ì–´ë³´ë¼ê³  í•œë‹¤.


### í•™ìŠµ í…ŒìŠ¤íŠ¸ ì˜ˆì œ

JUnitì´ í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œë¥¼ ìˆ˜í–‰í•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“ ë‹¤ê³  í–ˆë‹¤. 
ì´ê±¸ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ê²€ì¦í•´ë³´ì. 

ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³ , 3ê°œì˜ í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œë¥¼ ë§Œë“ ë‹¤.
í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ ìì‹ ì˜ íƒ€ì…ìœ¼ë¡œ static ë³€ìˆ˜ë¥¼ í•˜ë‚˜ ì„ ì–¸í•´ì„œ, ë§¤ í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œì—ì„œ í˜„ì¬ static ë³€ìˆ˜ì— ë‹´ê¸´ ìì‹ ì„ ë¹„êµí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ê°™ì€ì§€ ë‹¤ë¥¸ì§€ íŒë‹¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë§Œë“¤ì–´ë³´ì. 

```java
public class JUnitTest{
	static JUnitTest testObject;

	@Test
	public void test1(){
		assertThat(this, is(not(sameInstance(testObject))));
		testObject = this;
	}

	@Test
	public void test2(){
		assertThat(this, is(not(sameInstance(testObject))));
		testObject = this;
	}

	@Test
	public void test3(){
		assertThat(this, is(not(sameInstance(testObject))));
		testObject = this;
	}
}
```

ì¢€ ì—¬ëŸ¬ê°€ì§€ matcherê°€ ì¶”ê°€ë˜ì—ˆë‹¤. 
is(not()) ì€ ì²«ë²ˆì¨° íŒŒë¼ë¯¸í„°ì™€ ë‹¬ë¼ì•¼ ì„±ê³µí•˜ëŠ” matcher ì´ë‹¤. 
sameInstanceëŠ” ê°™ì€ ì˜¤ë¸Œì íŠ¸ì¸ì§€ ë¹„êµí•œë‹¤. 

ì—¬ê¸°ì„œëŠ” ì§ì „ objectë‘ë§Œ ë¹„êµí•˜ë‹ˆê¹Œ ë‹¤ìŒê³¼ ê°™ì´ ê°œì„ í•  ìˆ˜ ìˆë‹¤. 

```java
public class JUnitTest{
	static Set<JUnitTest> testObjects = new HashSet<JUnitTest>();

	@Test
	public void test1(){
		assertThat(testObjects, not(hasItem(this)));
		testObjects.add(this);
	}
	@Test
	public void test2(){
		assertThat(testObjects, not(hasItem(this)));
		testObjects.add(this);
	}
	@Test
	public void test3(){
		assertThat(testObjects, not(hasItem(this)));
		testObjects.add(this);
	}
}
```



ë‹¤ë¥¸ í•™ìŠµ í…ŒìŠ¤íŠ¸ë„ ì‘ì„±í•´ë³´ì. 
í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í…ŒìŠ¤íŠ¸ ê°œìˆ˜ì™€ ê´€ê³„ì—†ì´ í•˜ë‚˜ë§Œ ìƒì„±ëœë‹¤ê³  í–ˆë‹¤. 

ì´ë¥¼ ê²€ì¦í•´ë³´ì.

```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
public class JUnitTest{
	@Autowired ApplictionContext context;

	static Set<JUnitTest> testObjects = new HashSet<JUnitTest>();
	static ApplicationContext contextObject = null;

	@Test
	public void test1(){
		asssertThat(testObjects, not(hasItem(this)));
		testObjects.add(this);
		assertThat(contextObject == null || contextObject == this.context, is(true));
		contextObject = this.context;
	}

	@Test
	public void test2(){
		asssertThat(testObjects, not(hasItem(this)));
		testObjects.add(this);
		assertTrue(contextObject == null || contextObject == this.context);
		contextObject = this.context;
	}

	@Test
	public void test3(){
		asssertThat(testObjects, not(hasItem(this)));
		testObjects.add(this);
		assertThat(contextObject, either(is(nullValue())).or(is(this.context)));
		contextObject = this.context;
	}
}
```













