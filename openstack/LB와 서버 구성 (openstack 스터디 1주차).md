
## 세미나 내용

nginx 를 웹 서버가 동작하는 디바이스가 하나 있다고 치자. 여기의 ip는 1.1의 port는 80이다. 만약 하나 더 존재하게 되면 1.2  ip의 80 port라고 하자. 그럼 이 서버로 요청을 보낼 때는 어떻게 할까? 

DNS의 A type record에 각 서버의 ip를 2개 등록해놓으면 된다. 그럼 클라이언트가 해당 DNS로 요청을 보내게 되면 어디로 요청이 갈까? DNS는 round robin으로 관리하기 때문에 각 ip로 번갈아가면서 요청이 가게 된다. 근데 클라이언트는 요청을 보낼 때마다 dns에게 물어보는 것이 아니라 처음만 물어보고 caching 해두었다가 그거 쓴다. 그럼 만약 특정 클라이언트가 요청을 되게 많이 보내는 클라이언트라면 하나의 ip에 요청이 몰리게 된다. 

그래서 이럴 경우, DNS에 ip를 여러 개 등록하는 것이 아니라 로드밸런서(LB)를 두고 트래픽을 관리한다. 이러면 하나의 서버가 죽더라도 로드밸런서가 알아서 관리해준다. --> 어떻게 알아서? (이게 아마 내가 설명할 다음주 주제)

자 그럼 로드밸런서가 죽으면? 
그걸 방지하기 위해서 로드밸런서를 하나 더 둔다. 그리고 2개의 LB를 물리적인 케이블로 이어서 서로 health check를 하게 된다. A와 B라는 LB가 있고 서로 health check를 하고 있다고 하자. A가 1.1.1.1 이라는 ip에 대한 트래픽을 모두 수용하고 있다고 하자. 이때 A와 B가 서로 health check 하는 프로토콜은 vrrp https://blog.naver.com/sik7854/221869000354 라고 한다. 
이때 A LB가 죽으면 B가 1.1.1.1에 대한 ip를 가지게 되고 A의 역할을 대신 수행한다. 이때 1.1.1.1 은 떠다니는 ip라고 해서 ==vip==라고 부른다. 사실 vip 라고 부르는 이유는 실제론 다르지만 여기서 일단 그렇게 설명 (이게 아마 다음주 내가 설명할 주제)

여기서 의문. B LB가 ip를 가져온다고 했는데 내가 알기론 ip는 본인이 가져오고 싶다고 해서 가져오는 개념이 아니라 외부에서 지정하는 느낌이다. 그럼 B는 어떻게 1.1.1.1 ip를 본인에게 가져올 수 있을까?

이때 사용되는 protocol이 바로 GARP request이다. 그전에 ARP request를 먼저 알아야 한다. https://aws-hyoh.tistory.com/70 --> 완벽 설명 블로그
ARP request는 내가 궁금한 주소에 대해서 알아내는 방식이라서 수동적인 느낌이라면 GARP는 내 주소를 알려주어서 상대방의 ARP table을 수정하고 싶을 때 사용하는 것이다.

즉 B는 1.1.1.1 ip에 대해서 자신의 mac 주소를 mapping 하기 위해서 (요청이 전달되는 switch의 ARP table을 수정하기 위해서) GARP request를 보낸다. 


===========================
여기까지가 강의 내용이고 다음 번에 내가 설명할 부분에 대한 키워드와 주제는 다음과 같다. 

proxy
L2DSR

LB -> 서버로 health check하는 방법 3가지
LB -> 서버로 트래픽을 전달하는 방법은 여러개 

이거랑 switch가 LB에게 전달하는 방식의 차이를 알면 vip라고 부르는 이유를 알게 된다. 




## 자잘자잘한 지식

- L2 switch 라는 것은 physical Layer, Data Link Layer 2개층 까지만 보고 routing 하는 switch 라는 것이다. ARP table에 mapping 된 주소를 보고 ip에 해당하는 mac 주소로 요청을 보낸다는 것이다. 
- 